apiVersion: kyverno.io/v2beta1
kind: ClusterPolicy
metadata:
  name: generate-fleetworkspace-on-user
spec:
  admission: true
  background: true
  rules:
    - generate:
        apiVersion: management.cattle.io/v3
        data:
          metadata:
            annotations:
              field.cattle.io/creatorId: "{{request.object.metadata.name}}"
              gorizond-user.{{request.object.metadata.name}}.admin: admin
          spec: {}
        kind: FleetWorkspace
        name: "{{request.object.username}}-workspace"
      match:
        any:
          - resources:
              kinds:
                - management.cattle.io/v3/User
      name: generate-fleetworkspace
